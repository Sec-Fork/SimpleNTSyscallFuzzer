#include "stdafx.h"
#include "Header.h"

extern ulong OSVer;
extern ulong bMode;//0=> TOCTOU, 1=> Memory Disclosure

//I don't think Windows will have 0x1000 syscalls anytime soon
MYFUNC FuncTable[0x1000];
PREFUNC ModifyTable[0x1000];
POSTFUNC CleanTable[0x1000];

extern bool bWin7;
extern bool bWin10;

extern ulonglong AllKernelObject[0x5000];
extern ulong AllKernelObjectsUsed;

//Activate later
/*
void FillModifyTable(POSTFUNC* pTable)
{
	if(bWin7) memcpy(&ModifyTable[0],&ModifyTable_7[0],0x1000*0x8);
	else if(bWin10) memcpy(&ModifyTable[0],&ModifyTable_10[0],0x1000*0x8);
}
*/



//-----------------------------------------
void  DestroyFunctionTable(void* pExecPages,unsigned long SyscallCount,MYFUNC* pFuncTable,PREFUNC* pPreTable,POSTFUNC* pPostTable)
{
	if(!pExecPages || !SyscallCount || !pFuncTable) return;

	for(ulong i=0;i<SyscallCount;i++)
	{
		pFuncTable[i] = 0;
		if(pPreTable) pPreTable[i]=0;
		if(pPostTable) pPostTable[i]=0;
	}

	VirtualFree(pExecPages,0,MEM_RELEASE);
	return;
}

void DummyPre(unsigned long SysCall,
						unsigned long long* Args,
						void** pPool,
						void** pSecondLevelPool)
{

	for(ulong i=0;i<MAX_ARGS;i++)
	{
		ulong R = Rand()%6;
		if(R==0)
		{
			Args[i] = 0;
		}
		else if(R==1)
		{
			Args[i] = (ulonglong)(pPool[i]);
		}
		else if(R==2)
		{
			ulonglong tp[2] = {-1,-2};
			Args[i] = tp[Rand()%2];
		}
		else if(R==3)
		{
			if(i == 0 || i ==1 || i == 2)
			{
				Args[i] = Rand()%0x60;//class
			}
		}
		else if(R==4)
		{
			Args[i] = (ulonglong)(AllKernelObject[Rand()%AllKernelObjectsUsed]);
		}
		else
		{
			//Still Random
		}
	}

	return;
}

void PrintAllArgs(unsigned long long* Args)
{
	unsigned long Count = MAX_ARGS;
	for(ulong i=0;i<Count;i++)
	{
		printf("Arg#: %X, Value: %I64X\r\n",i,Args[i]);
	}
	return;
}

void DummyPost(unsigned long SysCall,
			unsigned long long* Args,
			void** pPool,
			void** pSecondLevelPool)
{
	if(!bMode) return;
	
	unsigned long Count = MAX_ARGS;
	if( ShouldSkipLeakChecking(SysCall) == false)
	{
		unsigned long i=0;

		bool bRet0,bRet1;

		for(i=0;i<Count;i++)
		{
			if(pPool[i])
			{
				bRet0 = Scan((void*)(pPool[i]),RANDOM_PAGE_SIZE,OSVer);
				if(bRet0)
				{
					printf("Kernel Address leak found, Syscall: %X, Arg# %X\r\n",SysCall,i);
					DumpHex_8(pPool[i],0x1000);
					PrintAllArgs(Args);
					printf("Press any key to continue\r\n");
					getchar();
					FillRandomData((void*)(pPool[i]),RANDOM_PAGE_SIZE);
				}
			}

			if(pSecondLevelPool[i])
			{
				bRet1 = Scan((void*)(pSecondLevelPool[i]),RANDOM_PAGE_SIZE,OSVer);
				if(bRet1)
				{
					printf("Kernel Address leak found, Syscall: %X, Arg# %X (Second Level Pool)\r\n",SysCall,i);
					DumpHex_8(pPool[i],0x1000);
					PrintAllArgs(Args);
					printf("Press any key to continue\r\n");
					getchar();
					FillRandomData((void*)(pSecondLevelPool[i]),RANDOM_PAGE_SIZE);
				}
			}
		}
	}
	else
	{
		for(ulong i=0;i<Count;i++)
		{
			if(pPool[i])
			{
				FillRandomData((void*)(pPool[i]),RANDOM_PAGE_SIZE);
			}

			if(pSecondLevelPool[i])
			{
				FillRandomData((void*)(pSecondLevelPool[i]),RANDOM_PAGE_SIZE);
			}
		}
	}

	return;
}

void CancelSyscall(unsigned long long* Args)
{
	if(Args)
	{
		for(unsigned long i=0;i<MAX_ARGS;i++)
		{
			Args[i]=0;
		}
	}
	return;
}


//--------------------- Legacy -----------------------
MYFUNC CreateFunction(unsigned long SyscallNumber)
{
	//printf("size: %X\r\n",sizeof(Sk));
	char Sk[] = "\x4C\x8B\xD1\xB8\x10\x10\x00\x00\x0F\x05\xC3";
	char* pNew = (char*)VirtualAlloc(0,0x1000,MEM_COMMIT,PAGE_EXECUTE_READWRITE);
	if(pNew)
	{
		memcpy(pNew,Sk,sizeof(Sk));
		*(unsigned long*)(pNew+4) = SyscallNumber;
	}
	return (MYFUNC)pNew;
}

void ModifyFunction(MYFUNC pFunc,unsigned long SyscallNumber)
{
	if(pFunc)
	{
		char* pFuncC = (char*)pFunc;
		*(unsigned long*)(pFuncC+4) = SyscallNumber;
	}
}

void DestroyFunction(MYFUNC pFunc)
{
	//if(pFunc) VirtualFree(pFunc,0x1000,MEM_DECOMMIT);
	if(pFunc) VirtualFree(pFunc,0x0,MEM_RELEASE);
}
//---------------- End of Legacy ---------------------------
char* NtosCalls[0x1000]={0};



char* NtosCalls_7[0x1000]=
{"NtMapUserPhysicalPagesScatter",
"NtWaitForSingleObject",
"NtCallbackReturn",
"NtReadFile",
"NtDeviceIoControlFile",
"NtWriteFile",
"NtRemoveIoCompletion",
"NtReleaseSemaphore",
"NtReplyWaitReceivePort",
"NtReplyPort",
"NtSetInformationThread",
"NtSetEvent",
"NtClose",
"NtQueryObject",
"NtQueryInformationFile",
"NtOpenKey",
"NtEnumerateValueKey",
"NtFindAtom",
"NtQueryDefaultLocale",
"NtQueryKey",
"NtQueryValueKey",
"NtAllocateVirtualMemory",
"NtQueryInformationProcess",
"NtWaitForMultipleObjects32",
"NtWriteFileGather",
"NtSetInformationProcess",
"NtCreateKey",
"NtFreeVirtualMemory",
"NtImpersonateClientOfPort",
"NtReleaseMutant",
"NtQueryInformationToken",
"NtRequestWaitReplyPort",
"NtQueryVirtualMemory",
"NtOpenThreadToken",
"NtQueryInformationThread",
"NtOpenProcess",
"NtSetInformationFile",
"NtMapViewOfSection",
"NtAccessCheckAndAuditAlarm",
"NtUnmapViewOfSection",
"NtReplyWaitReceivePortEx",
"NtTerminateProcess",
"NtSetEventBoostPriority",
"NtReadFileScatter",
"NtOpenThreadTokenEx",
"NtOpenProcessTokenEx",
"NtQueryPerformanceCounter",
"NtEnumerateKey",
"NtOpenFile",
"NtDelayExecution",
"NtQueryDirectoryFile",
"NtQuerySystemInformation",
"NtOpenSection",
"NtQueryTimer",
"NtFsControlFile",
"NtWriteVirtualMemory",
"NtCloseObjectAuditAlarm",
"NtDuplicateObject",
"NtQueryAttributesFile",
"NtClearEvent",
"NtReadVirtualMemory",
"NtOpenEvent",
"NtAdjustPrivilegesToken",
"NtDuplicateToken",
"NtContinue",
"NtQueryDefaultUILanguage",
"NtQueueApcThread",
"NtYieldExecution",
"NtAddAtom",
"NtCreateEvent",
"NtQueryVolumeInformationFile",
"NtCreateSection",
"NtFlushBuffersFile",
"NtApphelpCacheControl",
"NtCreateProcessEx",
"NtCreateThread",
"NtIsProcessInJob",
"NtProtectVirtualMemory",
"NtQuerySection",
"NtResumeThread",
"NtTerminateThread",
"NtReadRequestData",
"NtCreateFile",
"NtQueryEvent",
"NtWriteRequestData",
"NtOpenDirectoryObject",
"NtAccessCheckByTypeAndAuditAlarm",
"NtQuerySystemTime",
"NtWaitForMultipleObjects",
"NtSetInformationObject",
"NtCancelIoFile",
"NtTraceEvent",
"NtPowerInformation",
"NtSetValueKey",
"NtCancelTimer",
"NtSetTimer",
"NtAcceptConnectPort",
"NtAccessCheck",
"NtAccessCheckByType",
"NtAccessCheckByTypeResultList",
"NtAccessCheckByTypeResultListAndAuditAlarm",
"NtAccessCheckByTypeResultListAndAuditAlarmByHandle",
"NtAddBootEntry",
"NtAddDriverEntry",
"NtAdjustGroupsToken",
"NtAlertResumeThread",
"NtAlertThread",
"NtAllocateLocallyUniqueId",
"NtAllocateReserveObject",
"NtAllocateUserPhysicalPages",
"NtAllocateUuids",
"NtAlpcAcceptConnectPort",
"NtAlpcCancelMessage",
"NtAlpcConnectPort",
"NtAlpcCreatePort",
"NtAlpcCreatePortSection",
"NtAlpcCreateResourceReserve",
"NtAlpcCreateSectionView",
"NtAlpcCreateSecurityContext",
"NtAlpcDeletePortSection",
"NtAlpcDeleteResourceReserve",
"NtAlpcDeleteSectionView",
"NtAlpcDeleteSecurityContext",
"NtAlpcDisconnectPort",
"NtAlpcImpersonateClientOfPort",
"NtAlpcOpenSenderProcess",
"NtAlpcOpenSenderThread",
"NtAlpcQueryInformation",
"NtAlpcQueryInformationMessage",
"NtAlpcRevokeSecurityContext",
"NtAlpcSendWaitReceivePort",
"NtAlpcSetInformation",
"NtAreMappedFilesTheSame",
"NtAssignProcessToJobObject",
"NtCancelIoFileEx",
"NtCancelSynchronousIoFile",
"NtCommitComplete",
"NtCommitEnlistment",
"NtCommitTransaction",
"NtCompactKeys",
"NtCompareTokens",
"xHalGetInterruptTranslator",
"NtCompressKey",
"NtConnectPort",
"NtCreateDebugObject",
"NtCreateDirectoryObject",
"NtCreateEnlistment",
"NtCreateEventPair",
"NtCreateIoCompletion",
"NtCreateJobObject",
"NtCreateJobSet",
"NtCreateKeyTransacted",
"NtCreateKeyedEvent",
"NtCreateMailslotFile",
"NtCreateMutant",
"NtCreateNamedPipeFile",
"NtCreatePagingFile",
"NtCreatePort",
"NtCreatePrivateNamespace",
"NtCreateProcess",
"NtCreateProfile",
"NtCreateProfileEx",
"NtCreateResourceManager",
"NtCreateSemaphore",
"NtCreateSymbolicLinkObject",
"NtCreateThreadEx",
"NtCreateTimer",
"NtCreateToken",
"NtCreateTransaction",
"NtCreateTransactionManager",
"NtCreateUserProcess",
"NtCreateWaitablePort",
"NtCreateWorkerFactory",
"NtDebugActiveProcess",
"NtDebugContinue",
"NtDeleteAtom",
"NtDeleteBootEntry",
"NtDeleteDriverEntry",
"NtDeleteFile",
"NtDeleteKey",
"NtDeleteObjectAuditAlarm",
"NtDeletePrivateNamespace",
"NtDeleteValueKey",
"NtDisableLastKnownGood",
"NtDisplayString",
"NtDrawText",
"NtEnableLastKnownGood",
"NtEnumerateBootEntries",
"NtEnumerateDriverEntries",
"NtEnumerateSystemEnvironmentValuesEx",
"NtEnumerateTransactionObject",
"NtExtendSection",
"NtFilterToken",
"NtFlushInstallUILanguage",
"NtFlushInstructionCache",
"NtFlushKey",
"NtFlushProcessWriteBuffers",
"NtFlushVirtualMemory",
"NtFlushWriteBuffer",
"NtFreeUserPhysicalPages",
"NtFreezeRegistry",
"NtFreezeTransactions",
"NtGetContextThread",
"NtGetCurrentProcessorNumber",
"NtGetDevicePowerState",
"NtGetMUIRegistryInfo",
"NtGetNextProcess",
"NtGetNextThread",
"NtGetNlsSectionPtr",
"NtGetNotificationResourceManager",
"NtGetPlugPlayEvent",
"NtGetWriteWatch",
"NtImpersonateAnonymousToken",
"NtImpersonateThread",
"NtInitializeNlsFiles",
"NtInitializeRegistry",
"NtInitiatePowerAction",
"NtIsSystemResumeAutomatic",
"NtIsUILanguageComitted",
"NtListenPort",
"NtLoadDriver",
"NtLoadKey",
"NtLoadKey2",
"NtLoadKeyEx",
"NtLockFile",
"NtLockProductActivationKeys",
"NtLockRegistryKey",
"NtLockVirtualMemory",
"NtMakePermanentObject",
"NtMakeTemporaryObject",
"NtMapCMFModule",
"NtMapUserPhysicalPages",
"NtModifyBootEntry",
"NtModifyDriverEntry",
"NtNotifyChangeDirectoryFile",
"NtNotifyChangeKey",
"NtNotifyChangeMultipleKeys",
"NtNotifyChangeSession",
"NtOpenEnlistment",
"NtOpenEventPair",
"NtOpenIoCompletion",
"NtOpenJobObject",
"NtOpenKeyEx",
"NtOpenKeyTransacted",
"NtOpenKeyTransactedEx",
"NtOpenKeyedEvent",
"NtOpenMutant",
"NtOpenObjectAuditAlarm",
"NtOpenPrivateNamespace",
"NtOpenProcessToken",
"NtOpenResourceManager",
"NtOpenSemaphore",
"NtOpenSession",
"NtOpenSymbolicLinkObject",
"NtOpenThread",
"NtOpenTimer",
"NtOpenTransaction",
"NtOpenTransactionManager",
"NtPlugPlayControl",
"NtPrePrepareComplete",
"NtPrePrepareEnlistment",
"NtPrepareComplete",
"NtPrepareEnlistment",
"NtPrivilegeCheck",
"NtPrivilegeObjectAuditAlarm",
"NtPrivilegedServiceAuditAlarm",
"NtPropagationComplete",
"NtPropagationFailed",
"NtPulseEvent",
"NtQueryBootEntryOrder",
"NtQueryBootOptions",
"NtQueryDebugFilterState",
"NtQueryDirectoryObject",
"NtQueryDriverEntryOrder",
"NtQueryEaFile",
"NtQueryFullAttributesFile",
"NtQueryInformationAtom",
"NtQueryInformationEnlistment",
"NtQueryInformationJobObject",
"NtQueryInformationPort",
"NtQueryInformationResourceManager",
"NtQueryInformationTransaction",
"NtQueryInformationTransactionManager",
"NtQueryInformationWorkerFactory",
"NtQueryInstallUILanguage",
"NtQueryIntervalProfile",
"NtQueryIoCompletion",
"NtQueryLicenseValue",
"NtQueryMultipleValueKey",
"NtQueryMutant",
"NtQueryOpenSubKeys",
"NtQueryOpenSubKeysEx",
"NtQueryPortInformationProcess",
"NtQueryQuotaInformationFile",
"NtQuerySecurityAttributesToken",
"NtQuerySecurityObject",
"NtQuerySemaphore",
"NtQuerySymbolicLinkObject",
"NtQuerySystemEnvironmentValue",
"NtQuerySystemEnvironmentValueEx",
"NtQuerySystemInformationEx",
"NtQueryTimerResolution",
"NtQueueApcThreadEx",
"NtRaiseException",
"NtRaiseHardError",
"NtReadOnlyEnlistment",
"NtRecoverEnlistment",
"NtRecoverResourceManager",
"NtRecoverTransactionManager",
"NtRegisterProtocolAddressInformation",
"NtRegisterThreadTerminatePort",
"NtReleaseKeyedEvent",
"NtReleaseWorkerFactoryWorker",
"NtRemoveIoCompletionEx",
"NtRemoveProcessDebug",
"NtRenameKey",
"NtRenameTransactionManager",
"NtReplaceKey",
"NtReplacePartitionUnit",
"NtReplyWaitReplyPort",
"NtRequestPort",
"NtResetEvent",
"NtResetWriteWatch",
"NtRestoreKey",
"NtResumeProcess",
"NtRollbackComplete",
"NtRollbackEnlistment",
"NtRollbackTransaction",
"NtRollforwardTransactionManager",
"NtSaveKey",
"NtSaveKeyEx",
"NtSaveMergedKeys",
"NtSecureConnectPort",
"NtSerializeBoot",
"NtSetBootEntryOrder",
"NtSetBootOptions",
"NtSetContextThread",
"NtSetDebugFilterState",
"NtSetDefaultHardErrorPort",
"NtSetDefaultLocale",
"NtSetDefaultUILanguage",
"NtSetDriverEntryOrder",
"NtSetEaFile",
"NtSetHighEventPair",
"NtSetHighWaitLowEventPair",
"NtSetInformationDebugObject",
"NtSetInformationEnlistment",
"NtSetInformationJobObject",
"NtSetInformationKey",
"NtSetInformationResourceManager",
"NtSetInformationToken",
"NtSetInformationTransaction",
"NtSetInformationTransactionManager",
"NtSetInformationWorkerFactory",
"NtSetIntervalProfile",
"NtSetIoCompletion",
"NtSetIoCompletionEx",
"xKdSetupPciDeviceForDebugging",
"NtSetLowEventPair",
"NtSetLowWaitHighEventPair",
"NtSetQuotaInformationFile",
"NtSetSecurityObject",
"NtSetSystemEnvironmentValue",
"NtSetSystemEnvironmentValueEx",
"NtSetSystemInformation",
"NtSetSystemPowerState",
"NtSetSystemTime",
"NtSetThreadExecutionState",
"NtSetTimerEx",
"NtSetTimerResolution",
"NtSetUuidSeed",
"NtSetVolumeInformationFile",
"NtShutdownSystem",
"NtShutdownWorkerFactory",
"NtSignalAndWaitForSingleObject",
"NtSinglePhaseReject",
"NtStartProfile",
"NtStopProfile",
"NtSuspendProcess",
"NtSuspendThread",
"NtSystemDebugControl",
"NtTerminateJobObject",
"NtTestAlert",
"NtThawRegistry",
"NtThawTransactions",
"NtTraceControl",
"NtTranslateFilePath",
"NtUmsThreadYield",
"NtUnloadDriver",
"NtUnloadKey",
"NtUnloadKey2",
"NtUnloadKeyEx",
"NtUnlockFile",
"NtUnlockVirtualMemory",
"NtVdmControl",
"NtWaitForDebugEvent",
"NtWaitForKeyedEvent",
"NtWaitForWorkViaWorkerFactory",
"NtWaitHighEventPair",
"NtWaitLowEventPair",
"NtWorkerFactoryWorkerReady"
};

char* NtosCalls_10[0x1000]=
{"NtAccessCheck",
"NtWorkerFactoryWorkerReady",
"NtAcceptConnectPort",
"NtMapUserPhysicalPagesScatter",
"NtWaitForSingleObject",
"NtCallbackReturn",
"NtReadFile",
"NtDeviceIoControlFile",
"NtWriteFile",
"NtRemoveIoCompletion",
"NtReleaseSemaphore",
"NtReplyWaitReceivePort",
"NtReplyPort",
"NtSetInformationThread",
"NtSetEvent",
"NtClose",
"NtQueryObject",
"NtQueryInformationFile",
"NtOpenKey",
"NtEnumerateValueKey",
"NtFindAtom",
"NtQueryDefaultLocale",
"NtQueryKey",
"NtQueryValueKey",
"NtAllocateVirtualMemory",
"NtQueryInformationProcess",
"NtWaitForMultipleObjects32",
"NtWriteFileGather",
"NtSetInformationProcess",
"NtCreateKey",
"NtFreeVirtualMemory",
"NtImpersonateClientOfPort",
"NtReleaseMutant",
"NtQueryInformationToken",
"NtRequestWaitReplyPort",
"NtQueryVirtualMemory",
"NtOpenThreadToken",
"NtQueryInformationThread",
"NtOpenProcess",
"NtSetInformationFile",
"NtMapViewOfSection",
"NtAccessCheckAndAuditAlarm",
"NtUnmapViewOfSection",
"NtReplyWaitReceivePortEx",
"NtTerminateProcess",
"NtSetEventBoostPriority",
"NtReadFileScatter",
"NtOpenThreadTokenEx",
"NtOpenProcessTokenEx",
"NtQueryPerformanceCounter",
"NtEnumerateKey",
"NtOpenFile",
"NtDelayExecution",
"NtQueryDirectoryFile",
"NtQuerySystemInformation",
"NtOpenSection",
"NtQueryTimer",
"NtFsControlFile",
"NtWriteVirtualMemory",
"NtCloseObjectAuditAlarm",
"NtDuplicateObject",
"NtQueryAttributesFile",
"NtClearEvent",
"NtReadVirtualMemory",
"NtOpenEvent",
"NtAdjustPrivilegesToken",
"NtDuplicateToken",
"NtContinue",
"NtQueryDefaultUILanguage",
"NtQueueApcThread",
"NtYieldExecution",
"NtAddAtom",
"NtCreateEvent",
"NtQueryVolumeInformationFile",
"NtCreateSection",
"NtFlushBuffersFile",
"NtApphelpCacheControl",
"NtCreateProcessEx",
"NtCreateThread",
"NtIsProcessInJob",
"NtProtectVirtualMemory",
"NtQuerySection",
"NtResumeThread",
"NtTerminateThread",
"NtReadRequestData",
"NtCreateFile",
"NtQueryEvent",
"NtWriteRequestData",
"NtOpenDirectoryObject",
"NtAccessCheckByTypeAndAuditAlarm",
"NtNullSyscall**",
"NtWaitForMultipleObjects",
"NtSetInformationObject",
"NtCancelIoFile",
"NtTraceEvent",
"NtPowerInformation",
"NtSetValueKey",
"NtCancelTimer",
"NtSetTimer",
"NtAccessCheckByType",
"NtAccessCheckByTypeResultList",
"NtAccessCheckByTypeResultListAndAuditAlarm",
"NtAccessCheckByTypeResultListAndAuditAlarmByHandle",
"NtAcquireCrossVmMutant",
"NtAcquireProcessActivityReference",
"NtAddAtomEx",
"NtAddBootEntry",
"NtAddDriverEntry",
"NtAdjustGroupsToken",
"NtAdjustTokenClaimsAndDeviceGroups",
"NtAlertResumeThread",
"NtAlertThread",
"NtAlertThreadByThreadId",
"NtAllocateLocallyUniqueId",
"NtAllocateReserveObject",
"NtAllocateUserPhysicalPages",
"NtAllocateUserPhysicalPagesEx",
"NtAllocateUuids",
"NtAllocateVirtualMemoryEx",
"NtAlpcAcceptConnectPort",
"NtAlpcCancelMessage",
"NtAlpcConnectPort",
"NtAlpcConnectPortEx",
"NtAlpcCreatePort",
"NtAlpcCreatePortSection",
"NtAlpcCreateResourceReserve",
"NtAlpcCreateSectionView",
"NtAlpcCreateSecurityContext",
"NtAlpcDeletePortSection",
"NtAlpcDeleteResourceReserve",
"NtAlpcDeleteSectionView",
"NtAlpcDeleteSecurityContext",
"NtAlpcDisconnectPort",
"NtAlpcImpersonateClientContainerOfPort",
"NtAlpcImpersonateClientOfPort",
"NtAlpcOpenSenderProcess",
"NtAlpcOpenSenderThread",
"NtAlpcQueryInformation",
"NtAlpcQueryInformationMessage",
"NtAlpcRevokeSecurityContext",
"NtAlpcSendWaitReceivePort",
"NtAlpcSetInformation",
"NtAreMappedFilesTheSame",
"NtAssignProcessToJobObject",
"NtAssociateWaitCompletionPacket",
"NtCallEnclave",
"NtCancelIoFileEx",
"NtCancelSynchronousIoFile",
"NtCancelTimer2",
"NtCancelWaitCompletionPacket",
"NtCommitComplete",
"NtCommitEnlistment",
"NtCommitRegistryTransaction",
"NtCommitTransaction",
"NtCompactKeys",
"NtCompareObjects",
"NtCompareSigningLevels",
"NtCompareTokens",
"NtCompleteConnectPort",
"NtCompressKey",
"NtConnectPort",
"NtContinueEx",
"NtConvertBetweenAuxiliaryCounterAndPerformanceCounter",
"NtCreateCrossVmEvent",
"NtCreateCrossVmMutant",
"NtCreateDebugObject",
"NtCreateDirectoryObject",
"NtCreateDirectoryObjectEx",
"NtCreateEnclave",
"NtCreateEnlistment",
"NtCreateEventPair",
"NtCreateIRTimer",
"NtCreateIoCompletion",
"NtCreateJobObject",
"NtCreateJobSet",
"NtCreateKeyTransacted",
"NtCreateKeyedEvent",
"NtCreateLowBoxToken",
"NtCreateMailslotFile",
"NtCreateMutant",
"NtCreateNamedPipeFile",
"NtCreatePagingFile",
"NtCreatePartition",
"NtCreatePort",
"NtCreatePrivateNamespace",
"NtCreateProcess",
"NtCreateProfile",
"NtCreateProfileEx",
"NtCreateRegistryTransaction",
"NtCreateResourceManager",
"NtCreateSectionEx",
"NtCreateSemaphore",
"NtCreateSymbolicLinkObject",
"NtCreateThreadEx",
"NtCreateTimer",
"NtCreateTimer2",
"NtCreateToken",
"NtCreateTokenEx",
"NtCreateTransaction",
"NtCreateTransactionManager",
"NtCreateUserProcess",
"NtCreateWaitCompletionPacket",
"NtCreateWaitablePort",
"NtCreateWnfStateName",
"NtCreateWorkerFactory",
"NtDebugActiveProcess",
"NtDebugContinue",
"NtDeleteAtom",
"NtDeleteBootEntry",
"NtDeleteDriverEntry",
"NtDeleteFile",
"NtDeleteKey",
"NtDeleteObjectAuditAlarm",
"NtDeletePrivateNamespace",
"NtDeleteValueKey",
"NtDeleteWnfStateData",
"NtDeleteWnfStateName",
"NtDirectGraphicsCall",
"NtDisableLastKnownGood",
"NtDisplayString",
"NtDrawText",
"NtEnableLastKnownGood",
"NtEnumerateBootEntries",
"NtEnumerateDriverEntries",
"NtEnumerateSystemEnvironmentValuesEx",
"NtEnumerateTransactionObject",
"NtExtendSection",
"NtFilterBootOption",
"NtFilterToken",
"NtFilterTokenEx",
"NtFlushBuffersFileEx",
"NtFlushInstallUILanguage",
"NtFlushInstructionCache",
"NtFlushKey",
"NtFlushProcessWriteBuffers",
"NtFlushVirtualMemory",
"NtFlushWriteBuffer",
"NtFreeUserPhysicalPages",
"NtFreezeRegistry",
"NtFreezeTransactions",
"NtGetCachedSigningLevel",
"NtGetCompleteWnfStateSubscription",
"NtGetContextThread",
"NtGetCurrentProcessorNumber",
"NtGetCurrentProcessorNumberEx",
"NtGetDevicePowerState",
"NtGetMUIRegistryInfo",
"NtGetNextProcess",
"NtGetNextThread",
"NtGetNlsSectionPtr",
"NtGetNotificationResourceManager",
"NtGetWriteWatch",
"NtImpersonateAnonymousToken",
"NtImpersonateThread",
"NtInitializeEnclave",
"NtInitializeNlsFiles",
"NtInitializeRegistry",
"NtInitiatePowerAction",
"NtIsSystemResumeAutomatic",
"NtIsUILanguageComitted",
"NtListenPort",
"NtLoadDriver",
"NtLoadEnclaveData",
"NtLoadKey",
"NtLoadKey2",
"NtLoadKeyEx",
"NtLockFile",
"NtLockProductActivationKeys",
"NtLockRegistryKey",
"NtLockVirtualMemory",
"NtMakePermanentObject",
"NtMakeTemporaryObject",
"NtManageHotPatch",
"NtManagePartition",
"NtMapCMFModule",
"NtMapUserPhysicalPages",
"NtMapViewOfSectionEx",
"NtModifyBootEntry",
"NtModifyDriverEntry",
"NtNotifyChangeDirectoryFile",
"NtNotifyChangeDirectoryFileEx",
"NtNotifyChangeKey",
"NtNotifyChangeMultipleKeys",
"NtNotifyChangeSession",
"NtOpenEnlistment",
"NtOpenEventPair",
"NtOpenIoCompletion",
"NtOpenJobObject",
"NtOpenKeyEx",
"NtOpenKeyTransacted",
"NtOpenKeyTransactedEx",
"NtOpenKeyedEvent",
"NtOpenMutant",
"NtOpenObjectAuditAlarm",
"NtOpenPartition",
"NtOpenPrivateNamespace",
"NtOpenProcessToken",
"NtOpenRegistryTransaction",
"NtOpenResourceManager",
"NtOpenSemaphore",
"NtOpenSession",
"NtOpenSymbolicLinkObject",
"NtOpenThread",
"NtOpenTimer",
"NtOpenTransaction",
"NtOpenTransactionManager",
"NtPlugPlayControl",
"NtPrePrepareComplete",
"NtPrePrepareEnlistment",
"NtPrepareComplete",
"NtPrepareEnlistment",
"NtPrivilegeCheck",
"NtPrivilegeObjectAuditAlarm",
"NtPrivilegedServiceAuditAlarm",
"NtPropagationComplete",
"NtPropagationFailed",
"NtPssCaptureVaSpaceBulk",
"NtPulseEvent",
"NtQueryAuxiliaryCounterFrequency",
"NtQueryBootEntryOrder",
"NtQueryBootOptions",
"NtQueryDebugFilterState",
"NtQueryDirectoryFileEx",
"NtQueryDirectoryObject",
"NtQueryDriverEntryOrder",
"NtQueryEaFile",
"NtQueryFullAttributesFile",
"NtQueryInformationAtom",
"NtQueryInformationByName",
"NtQueryInformationEnlistment",
"NtQueryInformationJobObject",
"NtQueryInformationPort",
"NtQueryInformationResourceManager",
"NtQueryInformationTransaction",
"NtQueryInformationTransactionManager",
"NtQueryInformationWorkerFactory",
"NtQueryInstallUILanguage",
"NtQueryIntervalProfile",
"NtQueryIoCompletion",
"NtQueryLicenseValue",
"NtQueryMultipleValueKey",
"NtQueryMutant",
"NtQueryOpenSubKeys",
"NtQueryOpenSubKeysEx",
"NtQueryPortInformationProcess",
"NtQueryQuotaInformationFile",
"NtQuerySecurityAttributesToken",
"NtQuerySecurityObject",
"NtQuerySecurityPolicy",
"NtQuerySemaphore",
"NtQuerySymbolicLinkObject",
"NtQuerySystemEnvironmentValue",
"NtQuerySystemEnvironmentValueEx",
"NtQuerySystemInformationEx",
"NtQueryTimerResolution",
"NtQueryWnfStateData",
"NtQueryWnfStateNameInformation",
"NtQueueApcThreadEx",
"NtRaiseException",
"NtRaiseHardError",
"NtReadOnlyEnlistment",
"NtRecoverEnlistment",
"NtRecoverResourceManager",
"NtRecoverTransactionManager",
"NtRegisterProtocolAddressInformation",
"NtRegisterThreadTerminatePort",
"NtReleaseKeyedEvent",
"NtReleaseWorkerFactoryWorker",
"NtRemoveIoCompletionEx",
"NtRemoveProcessDebug",
"NtRenameKey",
"NtRenameTransactionManager",
"NtReplaceKey",
"NtReplacePartitionUnit",
"NtReplyWaitReplyPort",
"NtRequestPort",
"NtResetEvent",
"NtResetWriteWatch",
"NtRestoreKey",
"NtResumeProcess",
"NtRevertContainerImpersonation",
"NtRollbackComplete",
"NtRollbackEnlistment",
"NtRollbackRegistryTransaction",
"NtRollbackTransaction",
"NtRollforwardTransactionManager",
"NtSaveKey",
"NtSaveKeyEx",
"NtSaveMergedKeys",
"NtSecureConnectPort",
"NtSerializeBoot",
"NtSetBootEntryOrder",
"NtSetBootOptions",
"NtSetCachedSigningLevel",
"NtSetCachedSigningLevel2",
"NtSetContextThread",
"NtSetDebugFilterState",
"NtSetDefaultHardErrorPort",
"NtSetDefaultLocale",
"NtSetDefaultUILanguage",
"NtSetDriverEntryOrder",
"NtSetEaFile",
"NtSetHighEventPair",
"NtSetHighWaitLowEventPair",
"NtSetIRTimer",
"NtSetInformationDebugObject",
"NtSetInformationEnlistment",
"NtSetInformationJobObject",
"NtSetInformationKey",
"NtSetInformationResourceManager",
"NtSetInformationSymbolicLink",
"NtSetInformationToken",
"NtSetInformationTransaction",
"NtSetInformationTransactionManager",
"NtSetInformationVirtualMemory",
"NtSetInformationWorkerFactory",
"NtSetIntervalProfile",
"NtSetIoCompletion",
"NtSetIoCompletionEx",
"NtSetLdtEntries",
"NtSetLowEventPair",
"NtSetLowWaitHighEventPair",
"NtSetQuotaInformationFile",
"NtSetSecurityObject",
"NtSetSystemEnvironmentValue",
"NtSetSystemEnvironmentValueEx",
"NtSetSystemInformation",
"NtSetSystemPowerState",
"NtSetSystemTime",
"NtSetThreadExecutionState",
"NtSetTimer2",
"NtSetTimerEx",
"NtSetTimerResolution",
"NtSetUuidSeed",
"NtSetVolumeInformationFile",
"NtSetWnfProcessNotificationEvent",
"NtShutdownSystem",
"NtShutdownWorkerFactory",
"NtSignalAndWaitForSingleObject",
"NtSinglePhaseReject",
"NtStartProfile",
"NtStopProfile",
"NtSubscribeWnfStateChange",
"NtSuspendProcess",
"NtSuspendThread",
"NtSystemDebugControl",
"NtTerminateEnclave",
"NtTerminateJobObject",
"NtTestAlert",
"NtThawRegistry",
"NtThawTransactions",
"NtTraceControl",
"NtTranslateFilePath",
"NtUmsThreadYield",
"NtUnloadDriver",
"NtUnloadKey",
"NtUnloadKey2",
"NtUnloadKeyEx",
"NtUnlockFile",
"NtUnlockVirtualMemory",
"NtUnmapViewOfSectionEx",
"NtUnsubscribeWnfStateChange",
"NtUpdateWnfStateData",
"NtVdmControl",
"NtWaitForAlertByThreadId",
"NtWaitForDebugEvent",
"NtWaitForKeyedEvent",
"NtWaitForWorkViaWorkerFactory",
"NtWaitHighEventPair",
"NtWaitLowEventPair",
"NtLoadKey3"};

//--------------



//------------------------------------------

PREFUNC ModifyTable_7[0x1000]=
{w7NtMapUserPhysicalPagesScatter,
w7NtWaitForSingleObject,
w7NtCallbackReturn,
w7NtReadFile,
w7NtDeviceIoControlFile,
w7NtWriteFile,
w7NtRemoveIoCompletion,
w7NtReleaseSemaphore,
w7NtReplyWaitReceivePort,
w7NtReplyPort,
w7NtSetInformationThread,
w7NtSetEvent,
w7NtClose,
w7NtQueryObject,
w7NtQueryInformationFile,
w7NtOpenKey,
w7NtEnumerateValueKey,
w7NtFindAtom,
w7NtQueryDefaultLocale,
w7NtQueryKey,
w7NtQueryValueKey,
w7NtAllocateVirtualMemory,
w7NtQueryInformationProcess,
w7NtWaitForMultipleObjects32,
w7NtWriteFileGather,
w7NtSetInformationProcess,
w7NtCreateKey,
w7NtFreeVirtualMemory,
w7NtImpersonateClientOfPort,
w7NtReleaseMutant,
w7NtQueryInformationToken,
w7NtRequestWaitReplyPort,
w7NtQueryVirtualMemory,
w7NtOpenThreadToken,
w7NtQueryInformationThread,
w7NtOpenProcess,
w7NtSetInformationFile,
w7NtMapViewOfSection,
w7NtAccessCheckAndAuditAlarm,
w7NtUnmapViewOfSection,
w7NtReplyWaitReceivePortEx,
w7NtTerminateProcess,
w7NtSetEventBoostPriority,
w7NtReadFileScatter,
w7NtOpenThreadTokenEx,
w7NtOpenProcessTokenEx,
w7NtQueryPerformanceCounter,
w7NtEnumerateKey,
w7NtOpenFile,
w7NtDelayExecution,
w7NtQueryDirectoryFile,
w7NtQuerySystemInformation,
w7NtOpenSection,
w7NtQueryTimer,
w7NtFsControlFile,
w7NtWriteVirtualMemory,
w7NtCloseObjectAuditAlarm,
w7NtDuplicateObject,
w7NtQueryAttributesFile,
w7NtClearEvent,
w7NtReadVirtualMemory,
w7NtOpenEvent,
w7NtAdjustPrivilegesToken,
w7NtDuplicateToken,
w7NtContinue,
w7NtQueryDefaultUILanguage,
w7NtQueueApcThread,
w7NtYieldExecution,
w7NtAddAtom,
w7NtCreateEvent,
w7NtQueryVolumeInformationFile,
w7NtCreateSection,
w7NtFlushBuffersFile,
w7NtApphelpCacheControl,
w7NtCreateProcessEx,
w7NtCreateThread,
w7NtIsProcessInJob,
w7NtProtectVirtualMemory,
w7NtQuerySection,
w7NtResumeThread,
w7NtTerminateThread,
w7NtReadRequestData,
w7NtCreateFile,
w7NtQueryEvent,
w7NtWriteRequestData,
w7NtOpenDirectoryObject,
w7NtAccessCheckByTypeAndAuditAlarm,
w7NtQuerySystemTime,
w7NtWaitForMultipleObjects,
w7NtSetInformationObject,
w7NtCancelIoFile,
w7NtTraceEvent,
w7NtPowerInformation,
w7NtSetValueKey,
w7NtCancelTimer,
w7NtSetTimer,
w7NtAcceptConnectPort,
w7NtAccessCheck,
w7NtAccessCheckByType,
w7NtAccessCheckByTypeResultList,
w7NtAccessCheckByTypeResultListAndAuditAlarm,
w7NtAccessCheckByTypeResultListAndAuditAlarmByHandle,
w7NtAddBootEntry,
w7NtAddDriverEntry,
w7NtAdjustGroupsToken,
w7NtAlertResumeThread,
w7NtAlertThread,
w7NtAllocateLocallyUniqueId,
w7NtAllocateReserveObject,
w7NtAllocateUserPhysicalPages,
w7NtAllocateUuids,
w7NtAlpcAcceptConnectPort,
w7NtAlpcCancelMessage,
w7NtAlpcConnectPort,
w7NtAlpcCreatePort,
w7NtAlpcCreatePortSection,
w7NtAlpcCreateResourceReserve,
w7NtAlpcCreateSectionView,
w7NtAlpcCreateSecurityContext,
w7NtAlpcDeletePortSection,
w7NtAlpcDeleteResourceReserve,
w7NtAlpcDeleteSectionView,
w7NtAlpcDeleteSecurityContext,
w7NtAlpcDisconnectPort,
w7NtAlpcImpersonateClientOfPort,
w7NtAlpcOpenSenderProcess,
w7NtAlpcOpenSenderThread,
w7NtAlpcQueryInformation,
w7NtAlpcQueryInformationMessage,
w7NtAlpcRevokeSecurityContext,
w7NtAlpcSendWaitReceivePort,
w7NtAlpcSetInformation,
w7NtAreMappedFilesTheSame,
w7NtAssignProcessToJobObject,
w7NtCancelIoFileEx,
w7NtCancelSynchronousIoFile,
w7NtCommitComplete,
w7NtCommitEnlistment,
w7NtCommitTransaction,
w7NtCompactKeys,
w7NtCompareTokens,
w7xHalGetInterruptTranslator,
w7NtCompressKey,
w7NtConnectPort,
w7NtCreateDebugObject,
w7NtCreateDirectoryObject,
w7NtCreateEnlistment,
w7NtCreateEventPair,
w7NtCreateIoCompletion,
w7NtCreateJobObject,
w7NtCreateJobSet,
w7NtCreateKeyTransacted,
w7NtCreateKeyedEvent,
w7NtCreateMailslotFile,
w7NtCreateMutant,
w7NtCreateNamedPipeFile,
w7NtCreatePagingFile,
w7NtCreatePort,
w7NtCreatePrivateNamespace,
w7NtCreateProcess,
w7NtCreateProfile,
w7NtCreateProfileEx,
w7NtCreateResourceManager,
w7NtCreateSemaphore,
w7NtCreateSymbolicLinkObject,
w7NtCreateThreadEx,
w7NtCreateTimer,
w7NtCreateToken,
w7NtCreateTransaction,
w7NtCreateTransactionManager,
w7NtCreateUserProcess,
w7NtCreateWaitablePort,
w7NtCreateWorkerFactory,
w7NtDebugActiveProcess,
w7NtDebugContinue,
w7NtDeleteAtom,
w7NtDeleteBootEntry,
w7NtDeleteDriverEntry,
w7NtDeleteFile,
w7NtDeleteKey,
w7NtDeleteObjectAuditAlarm,
w7NtDeletePrivateNamespace,
w7NtDeleteValueKey,
w7NtDisableLastKnownGood,
w7NtDisplayString,
w7NtDrawText,
w7NtEnableLastKnownGood,
w7NtEnumerateBootEntries,
w7NtEnumerateDriverEntries,
w7NtEnumerateSystemEnvironmentValuesEx,
w7NtEnumerateTransactionObject,
w7NtExtendSection,
w7NtFilterToken,
w7NtFlushInstallUILanguage,
w7NtFlushInstructionCache,
w7NtFlushKey,
w7NtFlushProcessWriteBuffers,
w7NtFlushVirtualMemory,
w7NtFlushWriteBuffer,
w7NtFreeUserPhysicalPages,
w7NtFreezeRegistry,
w7NtFreezeTransactions,
w7NtGetContextThread,
w7NtGetCurrentProcessorNumber,
w7NtGetDevicePowerState,
w7NtGetMUIRegistryInfo,
w7NtGetNextProcess,
w7NtGetNextThread,
w7NtGetNlsSectionPtr,
w7NtGetNotificationResourceManager,
w7NtGetPlugPlayEvent,
w7NtGetWriteWatch,
w7NtImpersonateAnonymousToken,
w7NtImpersonateThread,
w7NtInitializeNlsFiles,
w7NtInitializeRegistry,
w7NtInitiatePowerAction,
w7NtIsSystemResumeAutomatic,
w7NtIsUILanguageComitted,
w7NtListenPort,
w7NtLoadDriver,
w7NtLoadKey,
w7NtLoadKey2,
w7NtLoadKeyEx,
w7NtLockFile,
w7NtLockProductActivationKeys,
w7NtLockRegistryKey,
w7NtLockVirtualMemory,
w7NtMakePermanentObject,
w7NtMakeTemporaryObject,
w7NtMapCMFModule,
w7NtMapUserPhysicalPages,
w7NtModifyBootEntry,
w7NtModifyDriverEntry,
w7NtNotifyChangeDirectoryFile,
w7NtNotifyChangeKey,
w7NtNotifyChangeMultipleKeys,
w7NtNotifyChangeSession,
w7NtOpenEnlistment,
w7NtOpenEventPair,
w7NtOpenIoCompletion,
w7NtOpenJobObject,
w7NtOpenKeyEx,
w7NtOpenKeyTransacted,
w7NtOpenKeyTransactedEx,
w7NtOpenKeyedEvent,
w7NtOpenMutant,
w7NtOpenObjectAuditAlarm,
w7NtOpenPrivateNamespace,
w7NtOpenProcessToken,
w7NtOpenResourceManager,
w7NtOpenSemaphore,
w7NtOpenSession,
w7NtOpenSymbolicLinkObject,
w7NtOpenThread,
w7NtOpenTimer,
w7NtOpenTransaction,
w7NtOpenTransactionManager,
w7NtPlugPlayControl,
w7NtPrePrepareComplete,
w7NtPrePrepareEnlistment,
w7NtPrepareComplete,
w7NtPrepareEnlistment,
w7NtPrivilegeCheck,
w7NtPrivilegeObjectAuditAlarm,
w7NtPrivilegedServiceAuditAlarm,
w7NtPropagationComplete,
w7NtPropagationFailed,
w7NtPulseEvent,
w7NtQueryBootEntryOrder,
w7NtQueryBootOptions,
w7NtQueryDebugFilterState,
w7NtQueryDirectoryObject,
w7NtQueryDriverEntryOrder,
w7NtQueryEaFile,
w7NtQueryFullAttributesFile,
w7NtQueryInformationAtom,
w7NtQueryInformationEnlistment,
w7NtQueryInformationJobObject,
w7NtQueryInformationPort,
w7NtQueryInformationResourceManager,
w7NtQueryInformationTransaction,
w7NtQueryInformationTransactionManager,
w7NtQueryInformationWorkerFactory,
w7NtQueryInstallUILanguage,
w7NtQueryIntervalProfile,
w7NtQueryIoCompletion,
w7NtQueryLicenseValue,
w7NtQueryMultipleValueKey,
w7NtQueryMutant,
w7NtQueryOpenSubKeys,
w7NtQueryOpenSubKeysEx,
w7NtQueryPortInformationProcess,
w7NtQueryQuotaInformationFile,
w7NtQuerySecurityAttributesToken,
w7NtQuerySecurityObject,
w7NtQuerySemaphore,
w7NtQuerySymbolicLinkObject,
w7NtQuerySystemEnvironmentValue,
w7NtQuerySystemEnvironmentValueEx,
w7NtQuerySystemInformationEx,
w7NtQueryTimerResolution,
w7NtQueueApcThreadEx,
w7NtRaiseException,
w7NtRaiseHardError,
w7NtReadOnlyEnlistment,
w7NtRecoverEnlistment,
w7NtRecoverResourceManager,
w7NtRecoverTransactionManager,
w7NtRegisterProtocolAddressInformation,
w7NtRegisterThreadTerminatePort,
w7NtReleaseKeyedEvent,
w7NtReleaseWorkerFactoryWorker,
w7NtRemoveIoCompletionEx,
w7NtRemoveProcessDebug,
w7NtRenameKey,
w7NtRenameTransactionManager,
w7NtReplaceKey,
w7NtReplacePartitionUnit,
w7NtReplyWaitReplyPort,
w7NtRequestPort,
w7NtResetEvent,
w7NtResetWriteWatch,
w7NtRestoreKey,
w7NtResumeProcess,
w7NtRollbackComplete,
w7NtRollbackEnlistment,
w7NtRollbackTransaction,
w7NtRollforwardTransactionManager,
w7NtSaveKey,
w7NtSaveKeyEx,
w7NtSaveMergedKeys,
w7NtSecureConnectPort,
w7NtSerializeBoot,
w7NtSetBootEntryOrder,
w7NtSetBootOptions,
w7NtSetContextThread,
w7NtSetDebugFilterState,
w7NtSetDefaultHardErrorPort,
w7NtSetDefaultLocale,
w7NtSetDefaultUILanguage,
w7NtSetDriverEntryOrder,
w7NtSetEaFile,
w7NtSetHighEventPair,
w7NtSetHighWaitLowEventPair,
w7NtSetInformationDebugObject,
w7NtSetInformationEnlistment,
w7NtSetInformationJobObject,
w7NtSetInformationKey,
w7NtSetInformationResourceManager,
w7NtSetInformationToken,
w7NtSetInformationTransaction,
w7NtSetInformationTransactionManager,
w7NtSetInformationWorkerFactory,
w7NtSetIntervalProfile,
w7NtSetIoCompletion,
w7NtSetIoCompletionEx,
w7xKdSetupPciDeviceForDebugging,
w7NtSetLowEventPair,
w7NtSetLowWaitHighEventPair,
w7NtSetQuotaInformationFile,
w7NtSetSecurityObject,
w7NtSetSystemEnvironmentValue,
w7NtSetSystemEnvironmentValueEx,
w7NtSetSystemInformation,
w7NtSetSystemPowerState,
w7NtSetSystemTime,
w7NtSetThreadExecutionState,
w7NtSetTimerEx,
w7NtSetTimerResolution,
w7NtSetUuidSeed,
w7NtSetVolumeInformationFile,
w7NtShutdownSystem,
w7NtShutdownWorkerFactory,
w7NtSignalAndWaitForSingleObject,
w7NtSinglePhaseReject,
w7NtStartProfile,
w7NtStopProfile,
w7NtSuspendProcess,
w7NtSuspendThread,
w7NtSystemDebugControl,
w7NtTerminateJobObject,
w7NtTestAlert,
w7NtThawRegistry,
w7NtThawTransactions,
w7NtTraceControl,
w7NtTranslateFilePath,
w7NtUmsThreadYield,
w7NtUnloadDriver,
w7NtUnloadKey,
w7NtUnloadKey2,
w7NtUnloadKeyEx,
w7NtUnlockFile,
w7NtUnlockVirtualMemory,
w7NtVdmControl,
w7NtWaitForDebugEvent,
w7NtWaitForKeyedEvent,
w7NtWaitForWorkViaWorkerFactory,
w7NtWaitHighEventPair,
w7NtWaitLowEventPair,
w7NtWorkerFactoryWorkerReady
};

//----------------- win10------------------


PREFUNC ModifyTable_10[0x1000]=
{w7NtAccessCheck,
w7NtWorkerFactoryWorkerReady,
w7NtAcceptConnectPort,
w7NtMapUserPhysicalPagesScatter,
w7NtWaitForSingleObject,
w7NtCallbackReturn,
w7NtReadFile,
w7NtDeviceIoControlFile,
w7NtWriteFile,
w7NtRemoveIoCompletion,
w7NtReleaseSemaphore,
w7NtReplyWaitReceivePort,
w7NtReplyPort,
w7NtSetInformationThread,
w7NtSetEvent,
w7NtClose,
w7NtQueryObject,
w7NtQueryInformationFile,
w7NtOpenKey,
w7NtEnumerateValueKey,
w7NtFindAtom,
w7NtQueryDefaultLocale,
w7NtQueryKey,
w7NtQueryValueKey,
w7NtAllocateVirtualMemory,
w7NtQueryInformationProcess,
w7NtWaitForMultipleObjects32,
w7NtWriteFileGather,
w7NtSetInformationProcess,
w7NtCreateKey,
w7NtFreeVirtualMemory,
w7NtImpersonateClientOfPort,
w7NtReleaseMutant,
w7NtQueryInformationToken,
w7NtRequestWaitReplyPort,
w7NtQueryVirtualMemory,
w7NtOpenThreadToken,
w7NtQueryInformationThread,
w7NtOpenProcess,
w7NtSetInformationFile,
w7NtMapViewOfSection,
w7NtAccessCheckAndAuditAlarm,
w7NtUnmapViewOfSection,
w7NtReplyWaitReceivePortEx,
w7NtTerminateProcess,
w7NtSetEventBoostPriority,
w7NtReadFileScatter,
w7NtOpenThreadTokenEx,
w7NtOpenProcessTokenEx,
w7NtQueryPerformanceCounter,
w7NtEnumerateKey,
w7NtOpenFile,
w7NtDelayExecution,
w7NtQueryDirectoryFile,
w7NtQuerySystemInformation,
w7NtOpenSection,
w7NtQueryTimer,
w7NtFsControlFile,
w7NtWriteVirtualMemory,
w7NtCloseObjectAuditAlarm,
w7NtDuplicateObject,
w7NtQueryAttributesFile,
w7NtClearEvent,
w7NtReadVirtualMemory,
w7NtOpenEvent,
w7NtAdjustPrivilegesToken,
w7NtDuplicateToken,
w7NtContinue,
w7NtQueryDefaultUILanguage,
w7NtQueueApcThread,
w7NtYieldExecution,
w7NtAddAtom,
w7NtCreateEvent,
w7NtQueryVolumeInformationFile,
w7NtCreateSection,
w7NtFlushBuffersFile,
w7NtApphelpCacheControl,
w7NtCreateProcessEx,
w7NtCreateThread,
w7NtIsProcessInJob,
w7NtProtectVirtualMemory,
w7NtQuerySection,
w7NtResumeThread,
w7NtTerminateThread,
w7NtReadRequestData,
w7NtCreateFile,
w7NtQueryEvent,
w7NtWriteRequestData,
w7NtOpenDirectoryObject,
w7NtAccessCheckByTypeAndAuditAlarm,
w10NtNullSyscall,
w7NtWaitForMultipleObjects,
w7NtSetInformationObject,
w7NtCancelIoFile,
w7NtTraceEvent,
w7NtPowerInformation,
w7NtSetValueKey,
w7NtCancelTimer,
w7NtSetTimer,
w7NtAccessCheckByType,
w7NtAccessCheckByTypeResultList,
w7NtAccessCheckByTypeResultListAndAuditAlarm,
w7NtAccessCheckByTypeResultListAndAuditAlarmByHandle,
w10NtAcquireCrossVmMutant,
w10NtAcquireProcessActivityReference,
w10NtAddAtomEx,
w7NtAddBootEntry,
w7NtAddDriverEntry,
w7NtAdjustGroupsToken,
w10NtAdjustTokenClaimsAndDeviceGroups,
w7NtAlertResumeThread,
w7NtAlertThread,
w10NtAlertThreadByThreadId,
w7NtAllocateLocallyUniqueId,
w7NtAllocateReserveObject,
w7NtAllocateUserPhysicalPages,
w10NtAllocateUserPhysicalPagesEx,
w7NtAllocateUuids,
w10NtAllocateVirtualMemoryEx,
w7NtAlpcAcceptConnectPort,
w7NtAlpcCancelMessage,
w7NtAlpcConnectPort,
w10NtAlpcConnectPortEx,
w7NtAlpcCreatePort,
w7NtAlpcCreatePortSection,
w7NtAlpcCreateResourceReserve,
w7NtAlpcCreateSectionView,
w7NtAlpcCreateSecurityContext,
w7NtAlpcDeletePortSection,
w7NtAlpcDeleteResourceReserve,
w7NtAlpcDeleteSectionView,
w7NtAlpcDeleteSecurityContext,
w7NtAlpcDisconnectPort,
w10NtAlpcImpersonateClientContainerOfPort,
w7NtAlpcImpersonateClientOfPort,
w7NtAlpcOpenSenderProcess,
w7NtAlpcOpenSenderThread,
w7NtAlpcQueryInformation,
w7NtAlpcQueryInformationMessage,
w7NtAlpcRevokeSecurityContext,
w7NtAlpcSendWaitReceivePort,
w7NtAlpcSetInformation,
w7NtAreMappedFilesTheSame,
w7NtAssignProcessToJobObject,
w10NtAssociateWaitCompletionPacket,
w10NtCallEnclave,
w7NtCancelIoFileEx,
w7NtCancelSynchronousIoFile,
w10NtCancelTimer2,
w10NtCancelWaitCompletionPacket,
w7NtCommitComplete,
w7NtCommitEnlistment,
w10NtCommitRegistryTransaction,
w7NtCommitTransaction,
w7NtCompactKeys,
w10NtCompareObjects,
w10NtCompareSigningLevels,
w7NtCompareTokens,
w10NtCompleteConnectPort,
w7NtCompressKey,
w7NtConnectPort,
w10NtContinueEx,
w10NtConvertBetweenAuxiliaryCounterAndPerformanceCounter,
w10NtCreateCrossVmEvent,
w10NtCreateCrossVmMutant,
w7NtCreateDebugObject,
w7NtCreateDirectoryObject,
w10NtCreateDirectoryObjectEx,
w10NtCreateEnclave,
w7NtCreateEnlistment,
w7NtCreateEventPair,
w10NtCreateIRTimer,
w7NtCreateIoCompletion,
w7NtCreateJobObject,
w7NtCreateJobSet,
w7NtCreateKeyTransacted,
w7NtCreateKeyedEvent,
w10NtCreateLowBoxToken,
w7NtCreateMailslotFile,
w7NtCreateMutant,
w7NtCreateNamedPipeFile,
w7NtCreatePagingFile,
w10NtCreatePartition,
w7NtCreatePort,
w7NtCreatePrivateNamespace,
w7NtCreateProcess,
w7NtCreateProfile,
w7NtCreateProfileEx,
w10NtCreateRegistryTransaction,
w7NtCreateResourceManager,
w10NtCreateSectionEx,
w7NtCreateSemaphore,
w7NtCreateSymbolicLinkObject,
w7NtCreateThreadEx,
w7NtCreateTimer,
w10NtCreateTimer2,
w7NtCreateToken,
w10NtCreateTokenEx,
w7NtCreateTransaction,
w7NtCreateTransactionManager,
w7NtCreateUserProcess,
w10NtCreateWaitCompletionPacket,
w7NtCreateWaitablePort,
w10NtCreateWnfStateName,
w7NtCreateWorkerFactory,
w7NtDebugActiveProcess,
w7NtDebugContinue,
w7NtDeleteAtom,
w7NtDeleteBootEntry,
w7NtDeleteDriverEntry,
w7NtDeleteFile,
w7NtDeleteKey,
w7NtDeleteObjectAuditAlarm,
w7NtDeletePrivateNamespace,
w7NtDeleteValueKey,
w10NtDeleteWnfStateData,
w10NtDeleteWnfStateName,
w10NtDirectGraphicsCall,
w7NtDisableLastKnownGood,
w7NtDisplayString,
w7NtDrawText,
w7NtEnableLastKnownGood,
w7NtEnumerateBootEntries,
w7NtEnumerateDriverEntries,
w7NtEnumerateSystemEnvironmentValuesEx,
w7NtEnumerateTransactionObject,
w7NtExtendSection,
w10NtFilterBootOption,
w7NtFilterToken,
w10NtFilterTokenEx,
w10NtFlushBuffersFileEx,
w7NtFlushInstallUILanguage,
w7NtFlushInstructionCache,
w7NtFlushKey,
w7NtFlushProcessWriteBuffers,
w7NtFlushVirtualMemory,
w7NtFlushWriteBuffer,
w7NtFreeUserPhysicalPages,
w7NtFreezeRegistry,
w7NtFreezeTransactions,
w10NtGetCachedSigningLevel,
w10NtGetCompleteWnfStateSubscription,
w7NtGetContextThread,
w7NtGetCurrentProcessorNumber,
w10NtGetCurrentProcessorNumberEx,
w7NtGetDevicePowerState,
w7NtGetMUIRegistryInfo,
w7NtGetNextProcess,
w7NtGetNextThread,
w7NtGetNlsSectionPtr,
w7NtGetNotificationResourceManager,
w7NtGetWriteWatch,
w7NtImpersonateAnonymousToken,
w7NtImpersonateThread,
w10NtInitializeEnclave,
w7NtInitializeNlsFiles,
w7NtInitializeRegistry,
w7NtInitiatePowerAction,
w7NtIsSystemResumeAutomatic,
w7NtIsUILanguageComitted,
w7NtListenPort,
w7NtLoadDriver,
w10NtLoadEnclaveData,
w7NtLoadKey,
w7NtLoadKey2,
w7NtLoadKeyEx,
w7NtLockFile,
w7NtLockProductActivationKeys,
w7NtLockRegistryKey,
w7NtLockVirtualMemory,
w7NtMakePermanentObject,
w7NtMakeTemporaryObject,
w10NtManageHotPatch,
w10NtManagePartition,
w7NtMapCMFModule,
w7NtMapUserPhysicalPages,
w10NtMapViewOfSectionEx,
w7NtModifyBootEntry,
w7NtModifyDriverEntry,
w7NtNotifyChangeDirectoryFile,
w10NtNotifyChangeDirectoryFileEx,
w7NtNotifyChangeKey,
w7NtNotifyChangeMultipleKeys,
w7NtNotifyChangeSession,
w7NtOpenEnlistment,
w7NtOpenEventPair,
w7NtOpenIoCompletion,
w7NtOpenJobObject,
w7NtOpenKeyEx,
w7NtOpenKeyTransacted,
w7NtOpenKeyTransactedEx,
w7NtOpenKeyedEvent,
w7NtOpenMutant,
w7NtOpenObjectAuditAlarm,
w10NtOpenPartition,
w7NtOpenPrivateNamespace,
w7NtOpenProcessToken,
w10NtOpenRegistryTransaction,
w7NtOpenResourceManager,
w7NtOpenSemaphore,
w7NtOpenSession,
w7NtOpenSymbolicLinkObject,
w7NtOpenThread,
w7NtOpenTimer,
w7NtOpenTransaction,
w7NtOpenTransactionManager,
w7NtPlugPlayControl,
w7NtPrePrepareComplete,
w7NtPrePrepareEnlistment,
w7NtPrepareComplete,
w7NtPrepareEnlistment,
w7NtPrivilegeCheck,
w7NtPrivilegeObjectAuditAlarm,
w7NtPrivilegedServiceAuditAlarm,
w7NtPropagationComplete,
w7NtPropagationFailed,
w10NtPssCaptureVaSpaceBulk,
w7NtPulseEvent,
w10NtQueryAuxiliaryCounterFrequency,
w7NtQueryBootEntryOrder,
w7NtQueryBootOptions,
w7NtQueryDebugFilterState,
w10NtQueryDirectoryFileEx,
w7NtQueryDirectoryObject,
w7NtQueryDriverEntryOrder,
w7NtQueryEaFile,
w7NtQueryFullAttributesFile,
w7NtQueryInformationAtom,
w10NtQueryInformationByName,
w7NtQueryInformationEnlistment,
w7NtQueryInformationJobObject,
w7NtQueryInformationPort,
w7NtQueryInformationResourceManager,
w7NtQueryInformationTransaction,
w7NtQueryInformationTransactionManager,
w7NtQueryInformationWorkerFactory,
w7NtQueryInstallUILanguage,
w7NtQueryIntervalProfile,
w7NtQueryIoCompletion,
w7NtQueryLicenseValue,
w7NtQueryMultipleValueKey,
w7NtQueryMutant,
w7NtQueryOpenSubKeys,
w7NtQueryOpenSubKeysEx,
w7NtQueryPortInformationProcess,
w7NtQueryQuotaInformationFile,
w7NtQuerySecurityAttributesToken,
w7NtQuerySecurityObject,
w10NtQuerySecurityPolicy,
w7NtQuerySemaphore,
w7NtQuerySymbolicLinkObject,
w7NtQuerySystemEnvironmentValue,
w7NtQuerySystemEnvironmentValueEx,
w7NtQuerySystemInformationEx,
w7NtQueryTimerResolution,
w10NtQueryWnfStateData,
w10NtQueryWnfStateNameInformation,
w7NtQueueApcThreadEx,
w7NtRaiseException,
w7NtRaiseHardError,
w7NtReadOnlyEnlistment,
w7NtRecoverEnlistment,
w7NtRecoverResourceManager,
w7NtRecoverTransactionManager,
w10NtRegisterProtocolAddressInformation,
w7NtRegisterThreadTerminatePort,
w7NtReleaseKeyedEvent,
w7NtReleaseWorkerFactoryWorker,
w7NtRemoveIoCompletionEx,
w7NtRemoveProcessDebug,
w7NtRenameKey,
w10NtRenameTransactionManager,
w7NtReplaceKey,
w7NtReplacePartitionUnit,
w7NtReplyWaitReplyPort,
w7NtRequestPort,
w7NtResetEvent,
w7NtResetWriteWatch,
w7NtRestoreKey,
w7NtResumeProcess,
w10NtRevertContainerImpersonation,
w7NtRollbackComplete,
w7NtRollbackEnlistment,
w10NtRollbackRegistryTransaction,
w7NtRollbackTransaction,
w10NtRollforwardTransactionManager,
w7NtSaveKey,
w7NtSaveKeyEx,
w7NtSaveMergedKeys,
w7NtSecureConnectPort,
w7NtSerializeBoot,
w7NtSetBootEntryOrder,
w7NtSetBootOptions,
w10NtSetCachedSigningLevel,
w10NtSetCachedSigningLevel2,
w7NtSetContextThread,
w7NtSetDebugFilterState,
w7NtSetDefaultHardErrorPort,
w7NtSetDefaultLocale,
w7NtSetDefaultUILanguage,
w7NtSetDriverEntryOrder,
w7NtSetEaFile,
w7NtSetHighEventPair,
w7NtSetHighWaitLowEventPair,
w10NtSetIRTimer,
w7NtSetInformationDebugObject,
w7NtSetInformationEnlistment,
w7NtSetInformationJobObject,
w7NtSetInformationKey,
w7NtSetInformationResourceManager,
w10NtSetInformationSymbolicLink,
w7NtSetInformationToken,
w7NtSetInformationTransaction,
w10NtSetInformationTransactionManager,
w10NtSetInformationVirtualMemory,
w7NtSetInformationWorkerFactory,
w7NtSetIntervalProfile,
w7NtSetIoCompletion,
w7NtSetIoCompletionEx,
w10NtSetLdtEntries,
w7NtSetLowEventPair,
w7NtSetLowWaitHighEventPair,
w7NtSetQuotaInformationFile,
w7NtSetSecurityObject,
w7NtSetSystemEnvironmentValue,
w7NtSetSystemEnvironmentValueEx,
w7NtSetSystemInformation,
w7NtSetSystemPowerState,
w7NtSetSystemTime,
w7NtSetThreadExecutionState,
w10NtSetTimer2,
w7NtSetTimerEx,
w7NtSetTimerResolution,
w7NtSetUuidSeed,
w7NtSetVolumeInformationFile,
w10NtSetWnfProcessNotificationEvent,
w7NtShutdownSystem,
w7NtShutdownWorkerFactory,
w7NtSignalAndWaitForSingleObject,
w10NtSinglePhaseReject,
w7NtStartProfile,
w7NtStopProfile,
w10NtSubscribeWnfStateChange,
w7NtSuspendProcess,
w7NtSuspendThread,
w7NtSystemDebugControl,
w10NtTerminateEnclave,
w7NtTerminateJobObject,
w7NtTestAlert,
w7NtThawRegistry,
w7NtThawTransactions,
w7NtTraceControl,
w7NtTranslateFilePath,
w7NtUmsThreadYield,
w7NtUnloadDriver,
w7NtUnloadKey,
w7NtUnloadKey2,
w7NtUnloadKeyEx,
w7NtUnlockFile,
w7NtUnlockVirtualMemory,
w10NtUnmapViewOfSectionEx,
w10NtUnsubscribeWnfStateChange,
w10NtUpdateWnfStateData,
w7NtVdmControl,
w10NtWaitForAlertByThreadId,
w7NtWaitForDebugEvent,
w7NtWaitForKeyedEvent,
w7NtWaitForWorkViaWorkerFactory,
w7NtWaitHighEventPair,
w7NtWaitLowEventPair,
w10NtLoadKey3};

//--------------------------
//returns Executable Pages
void* InitFunctionTable(unsigned long SyscallCount, unsigned long MinSyscallOrdinal,MYFUNC* pFuncTable,PREFUNC* pPreTable,POSTFUNC* pPostTable,ulong OSVer)
{
	if(!SyscallCount) return 0;
	if(!pFuncTable) return 0;

	char Sk[] = "\x4C\x8B\xD1\xB8\x10\x10\x00\x00\x0F\x05\xC3";
	unsigned long SizeToAlloc = sizeof(Sk) * SyscallCount;
	char* pExecPages = (char*)VirtualAlloc(0,SizeToAlloc,MEM_COMMIT,PAGE_EXECUTE_READWRITE);
	if(!pExecPages)
	{
		printf("Can't allocate page(s) for raw syscalls\r\n");
		return 0;
	}

	unsigned long offset = 0;
	unsigned long c_Syscall = MinSyscallOrdinal;

	for(unsigned long i=0;i<SyscallCount;i++)
	{
		char* pCurrent =  &pExecPages[offset];
		memcpy(pCurrent,&Sk[0],sizeof(Sk));

		*(unsigned long*)(pCurrent + 4) = c_Syscall;

		pFuncTable[i] = (MYFUNC)(pCurrent);

		
		if(OSVer == 0)
		{
			if(pPreTable) pPreTable[i] = ModifyTable_7[i];
		}
		else if(OSVer == 1)
		{
			if(pPreTable) pPreTable[i] = ModifyTable_10[i];
		}
		else
		{
			if(pPreTable) pPreTable[i] = DummyPre;
		}


		if(pPostTable) pPostTable[i] = DummyPost;


		offset += sizeof(Sk);
		c_Syscall++;
	}

	unsigned long OldProt;
	if(!VirtualProtect(pExecPages,SizeToAlloc,PAGE_EXECUTE_READ,&OldProt))
	{
		printf("Can't change protection for raw syscalls\r\n");
		VirtualFree(pExecPages,0,MEM_RELEASE);
		return 0;
	}


	return pExecPages;

}